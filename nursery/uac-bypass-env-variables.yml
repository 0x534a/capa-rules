rule:
  meta:
    name: UAC bypass exploiting Environment Variables
    rule-category: machine-access-control/process-manipulation/uac-bypass
    author: anamaria.martinezgom@fireeye.com
    scope: function
    references:
      - https://www.tiraniddo.dev/2017/05/exploiting-environment-variables-in.html
      - https://enigma0x3.net/2016/07/22/bypassing-uac-on-windows-10-using-disk-cleanup
  features:
    - and:
      - string: schtasks.exe
      - string: /Microsoft\\Windows\\DiskCleanup\\SilentCleanup/i
      - match: create process
      - optional:
        - or:
          - string: Environment
          - string: windir
          - match: set registry value
